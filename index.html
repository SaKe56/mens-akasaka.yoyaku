<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Men'sã€a:rã€‘ Akasaka ã”äºˆç´„</title>
</head>
<body style="margin: 0; padding: 0; background-color: #f5f5f5;">

    <header style="background-color: #fff; padding: 25px 15px; text-align: center; border-bottom: 2px solid #0073aa; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
        <h1 style="color: #333; margin: 0; font-size: 24px; font-weight: bold;">Men'sã€a:rã€‘ Akasaka</h1>
        <p style="color: #0073aa; font-weight: bold; margin: 8px 0 0; font-size: 14px;">ã€å®Œå…¨äºˆç´„åˆ¶ã€‘ãƒ¡ãƒ³ã‚ºç¾å®¹&è„±æ¯›ã‚µãƒ­ãƒ³</p>
    </header>

    <div style="padding: 15px;">
        <div id="booking-app" class="b-container">
            <div id="calendar-area" class="b-card">
                <div class="b-nav">
                    <button type="button" class="b-btn-nav" onclick="changeMonth(-1)">â—€ å‰æœˆ</button>
                    <div id="current-month" class="b-month-label"></div>
                    <button type="button" class="b-btn-nav" onclick="changeMonth(1)">æ¬¡æœˆ â–¶</button>
                </div>
                <div id="calendar-grid" class="b-grid"></div>
            </div>

            <div id="time-section" class="b-card" style="margin-top: 20px;">
                <div id="date-display" class="b-date-header-info">æ—¥ä»˜ã‚’é¸æŠã™ã‚‹ã¨ç©ºãçŠ¶æ³ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</div>
                <div class="b-week-scroll">
                    <div id="week-table" class="b-week-table"></div>
                </div>
            </div>

            <section style="text-align: center; padding: 20px; background-color: #eef7ff; border-radius: 12px; margin: 20px 0; border: 1px dashed #0073aa;">
                <p style="margin-bottom: 15px; font-weight: bold; font-size: 14px; color: #333;">ã”ä¸æ˜ç‚¹ã‚„é›»è©±ã§ã®ã”äºˆç´„ã¯ã“ã¡ã‚‰ã‹ã‚‰</p>
                <a href="tel:08073550333" style="display: inline-block; background-color: #0073aa; color: white; padding: 12px 30px; text-decoration: none; border-radius: 30px; font-weight: bold; font-size: 16px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                    ğŸ“ TELã§å•ã„åˆã‚ã›ã‚‹
                </a>
            </section>
            
    <div id="form-section" class="b-card b-form" style="display:none; margin-top: 20px;">
        <div class="b-summary" id="res-summary" style="background:#f0f7ff; padding:15px; border-radius:10px; margin-bottom:20px; border:1px solid #0073aa;"></div>
        
        <label class="b-label">â€»ãŠåå‰ï¼ˆãƒ•ãƒ«ãƒãƒ¼ãƒ ï¼‰</label>
<input type="text" id="u-name" class="b-input" placeholder="ãƒ•ãƒ«ãƒãƒ¼ãƒ ã‚’ã”è¨˜å…¥ãã ã•ã„">

<label class="b-label">â€»ãŠé›»è©±ç•ªå·ï¼ˆã”æ–°è¦æ§˜ã¯ã”è¨˜å…¥ã‚’ãŠé¡˜ã„ã—ã¾ã™ï¼‰</label>
<input type="tel" id="u-tel" class="b-input" placeholder="ä¾‹ï¼š09012345678">
<label class="b-label">å‚™è€ƒï¼ˆã”è³ªå•ã‚„ã”è¦æœ›ãŒã‚ã‚Œã°ã”è¨˜å…¥ãã ã•ã„ï¼‰</label>
<textarea id="u-notes" class="b-input" rows="3" placeholder="ä¾‹ï¼šè„±æ¯›ãŒã¯ã˜ã‚ã¦ã§ä¸å®‰ã€å ´æ‰€ãŒã‚ã‹ã‚‰ãªã„ã€ãªã©"></textarea>

        <label class="b-label">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é¸æŠã—ã¦ãã ã•ã„ï¼ˆè¤‡æ•°é¸æŠå¯ï¼‰</label>
        <div class="b-menu-list">
            <p class="b-menu-cat">ã€ã‚«ã‚¦ãƒ³ã‚»ãƒªãƒ³ã‚°ã€‘</p>
            <div class="b-menu-item" onclick="toggleMenu(this)" data-name="ç„¡æ–™ã‚«ã‚¦ãƒ³ã‚»ãƒªãƒ³ã‚°" data-price="0" data-min="20">ç„¡æ–™ã‚«ã‚¦ãƒ³ã‚»ãƒªãƒ³ã‚° (20åˆ† / 0å††)</div>

            <p class="b-menu-cat">ã€1éƒ¨ä½ã€‘</p>
            <div class="b-menu-item" onclick="toggleMenu(this)" data-name="åˆå›ãƒ’ã‚²è„±æ¯›" data-price="3980" data-min="15"><span style="color: #ff0000; font-weight: bold;">åˆå›</span>ãƒ’ã‚²è„±æ¯› (15åˆ† / 3,980å††)</div>
            <div class="b-menu-item" onclick="toggleMenu(this)" data-name="åˆå›VIOè„±æ¯›" data-price="4980" data-min="30"><span style="color: #ff0000; font-weight: bold;">åˆå›</span>VIOè„±æ¯› (30åˆ† / 4,980å††)</div>
            <div class="b-menu-item" onclick="toggleMenu(this)" data-name="åˆå›ä¸‹åŠèº«è„±æ¯›" data-price="4980" data-min="30"><span style="color: #ff0000; font-weight: bold;">åˆå›</span>ä¸‹åŠèº«è„±æ¯› (30åˆ† / 4,980å††)</div>
            <div class="b-menu-item" onclick="toggleMenu(this)" data-name="åˆå›ä¸ŠåŠèº«è„±æ¯›" data-price="4980" data-min="30"><span style="color: #ff0000; font-weight: bold;">åˆå›</span>ä¸ŠåŠèº«è„±æ¯› (30åˆ† / 4,980å††)</div>
            <div class="b-menu-item" onclick="toggleMenu(this)" data-name="ãƒ’ã‚²è„±æ¯›(éƒ½åº¦)" data-price="4400" data-min="15">éƒ½åº¦ãƒ’ã‚²è„±æ¯› (15åˆ† / 4,400å††)</div>
            <div class="b-menu-item" onclick="toggleMenu(this)" data-name="ãƒ’ã‚²è„±æ¯›(å›æ•°åˆ¸åˆ©ç”¨)" data-price="0" data-min="15">ãƒ’ã‚²è„±æ¯› (å›æ•°åˆ¸åˆ©ç”¨ / 15åˆ†)</div>
            <div class="b-menu-item" onclick="toggleMenu(this)" data-name="VIOè„±æ¯›(éƒ½åº¦)" data-price="11000" data-min="30">éƒ½åº¦VIOè„±æ¯› (30åˆ† / 11,000å††)</div>
            <div class="b-menu-item" onclick="toggleMenu(this)" data-name="VIOè„±æ¯›(å›æ•°åˆ¸åˆ©ç”¨)" data-price="0" data-min="30">VIOè„±æ¯› (å›æ•°åˆ¸åˆ©ç”¨ / 30åˆ†)</div>
            <div class="b-menu-item" onclick="toggleMenu(this)" data-name="ä¸‹åŠèº«è„±æ¯›(éƒ½åº¦)" data-price="11000" data-min="30">éƒ½åº¦ä¸‹åŠèº«è„±æ¯› (30åˆ† / 11,000å††)</div>
            <div class="b-menu-item" onclick="toggleMenu(this)" data-name="ä¸‹åŠèº«è„±æ¯›(å›æ•°åˆ¸åˆ©ç”¨)" data-price="0" data-min="30">ä¸‹åŠèº«è„±æ¯› (å›æ•°åˆ¸åˆ©ç”¨ / 30åˆ†)</div>
            <div class="b-menu-item" onclick="toggleMenu(this)" data-name="ä¸ŠåŠèº«è„±æ¯›(éƒ½åº¦)" data-price="11000" data-min="30">éƒ½åº¦ä¸ŠåŠèº«è„±æ¯› (30åˆ† / 11,000å††)</div>
            <div class="b-menu-item" onclick="toggleMenu(this)" data-name="ä¸ŠåŠèº«è„±æ¯›(å›æ•°åˆ¸åˆ©ç”¨)" data-price="0" data-min="30">ä¸ŠåŠèº«è„±æ¯› (å›æ•°åˆ¸åˆ©ç”¨ / 30åˆ†)</div>

            <p class="b-menu-cat">ã€2éƒ¨ä½ãƒ»3éƒ¨ä½ã€‘</p>
            <div class="b-menu-item" onclick="toggleMenu(this)" data-name="ãƒ’ã‚²ï¼‹ãã®ä»–2éƒ¨ä½ã‚»ãƒƒãƒˆ" data-price="14630" data-min="45">ãƒ’ã‚²ï¼‹ãã®ä»–2éƒ¨ä½ã‚»ãƒƒãƒˆ (45åˆ† / 14,630å††)</div>
            <div class="b-menu-item" onclick="toggleMenu(this)" data-name="ãƒ’ã‚²ã‚’é™¤ã2éƒ¨ä½ã‚»ãƒƒãƒˆ" data-price="20900" data-min="45">ãƒ’ã‚²ã‚’é™¤ã2éƒ¨ä½ã‚»ãƒƒãƒˆ (45åˆ† / 20,900å††)</div>
            <div class="b-menu-item" onclick="toggleMenu(this)" data-name="2éƒ¨ä½ã‚»ãƒƒãƒˆ(å›æ•°åˆ¸åˆ©ç”¨)" data-price="0" data-min="45">2éƒ¨ä½ã‚»ãƒƒãƒˆ(å›æ•°åˆ¸åˆ©ç”¨ / 45åˆ†)</div>
            <div class="b-menu-item" onclick="toggleMenu(this)" data-name="ãƒ’ã‚²ï¼‹ãã®ä»–3éƒ¨ä½ã‚»ãƒƒãƒˆ" data-price="23760" data-min="60">ãƒ’ã‚²ï¼‹ãã®ä»–3éƒ¨ä½ã‚»ãƒƒãƒˆ (60åˆ† / 23,760å††)</div>
            <div class="b-menu-item" onclick="toggleMenu(this)" data-name="ãƒ’ã‚²ã‚’é™¤ã3éƒ¨ä½ã‚»ãƒƒãƒˆ" data-price="29700" data-min="60">ãƒ’ã‚²ã‚’é™¤ã3éƒ¨ä½ã‚»ãƒƒãƒˆ (60åˆ† / 29,700å††)</div>
            <div class="b-menu-item" onclick="toggleMenu(this)" data-name="3éƒ¨ä½ã‚»ãƒƒãƒˆ(å›æ•°åˆ¸åˆ©ç”¨)" data-price="0" data-min="45">3éƒ¨ä½ã‚»ãƒƒãƒˆ(å›æ•°åˆ¸åˆ©ç”¨ / 45åˆ†)</div>

            <p class="b-menu-cat">ã€å…¨èº«ãƒ»æ™‚é–“åˆ¶ã€‘</p>
            <div class="b-menu-item" onclick="toggleMenu(this)" data-name="åˆå›å…¨èº«è„±æ¯›(é¡”é™¤ã)" data-price="12980" data-min="90"><span style="color: #ff0000; font-weight: bold;">åˆå›</span>å…¨èº«è„±æ¯›(é¡”é™¤ã) (90åˆ† / 12,980å††)</div>
            <div class="b-menu-item" onclick="toggleMenu(this)" data-name="å…¨èº«è„±æ¯›(é¡”ãƒ»VIOè¾¼)" data-price="31790" data-min="90">å…¨èº«è„±æ¯›ï¼ˆé¡”ãƒ»VIOè¾¼ï¼‰ (90åˆ† / 31,790å††)</div>
            <div class="b-menu-item" onclick="toggleMenu(this)" data-name="å…¨èº«è„±æ¯›(é¡”ãƒ»VIOè¾¼)(å›æ•°åˆ¸åˆ©ç”¨)" data-price="0" data-min="90">å…¨èº«è„±æ¯›(é¡”ãƒ»VIOè¾¼)(å›æ•°åˆ¸åˆ©ç”¨ / 90åˆ†)</div>
            <div class="b-menu-item" onclick="toggleMenu(this)" data-name="æ™‚é–“åˆ¶ã‚ªãƒ¼ãƒ€ãƒ¼ãƒ¡ã‚¤ãƒ‰15åˆ†" data-price="7700" data-min="20">æ™‚é–“åˆ¶ã‚ªãƒ¼ãƒ€ãƒ¼ãƒ¡ã‚¤ãƒ‰ (15åˆ† / 7,700å††)</div>
            <div class="b-menu-item" onclick="toggleMenu(this)" data-name="æ™‚é–“åˆ¶ã‚ªãƒ¼ãƒ€ãƒ¼ãƒ¡ã‚¤ãƒ‰15åˆ†(å›æ•°åˆ¸åˆ©ç”¨)" data-price="0" data-min="20">æ™‚é–“åˆ¶ã‚ªãƒ¼ãƒ€ãƒ¼ãƒ¡ã‚¤ãƒ‰15åˆ†(å›æ•°åˆ¸åˆ©ç”¨)</div>
            <div class="b-menu-item" onclick="toggleMenu(this)" data-name="æ™‚é–“åˆ¶ã‚ªãƒ¼ãƒ€ãƒ¼ãƒ¡ã‚¤ãƒ‰30åˆ†" data-price="11000" data-min="45">æ™‚é–“åˆ¶ã‚ªãƒ¼ãƒ€ãƒ¼ãƒ¡ã‚¤ãƒ‰ (30åˆ† / 11,000å††)</div>
            <div class="b-menu-item" onclick="toggleMenu(this)" data-name="æ™‚é–“åˆ¶ã‚ªãƒ¼ãƒ€ãƒ¼ãƒ¡ã‚¤ãƒ‰30åˆ†(å›æ•°åˆ¸åˆ©ç”¨)" data-price="0" data-min="45">æ™‚é–“åˆ¶ã‚ªãƒ¼ãƒ€ãƒ¼ãƒ¡ã‚¤ãƒ‰30åˆ†(å›æ•°åˆ¸åˆ©ç”¨)</div>

            <p class="b-menu-cat">ã€ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã€‘</p>
            <div class="b-menu-item" onclick="toggleMenu(this)" data-name="HI-EMT" data-price="6980" data-min="45">ã€ç—©èº«ãƒã‚·ãƒ³ã€‘HI-EMT (30åˆ† / 6,980å††)</div>
            <div class="b-menu-item" onclick="toggleMenu(this)" data-name="åˆå›ï¼‘ã‚«æ‰€ã ã‘ã®éƒ¨åˆ†è„±æ¯›" data-price="2200" data-min="10">åˆå›ï¼‘ãƒ¶æ‰€ã ã‘ã®éƒ¨åˆ†è„±æ¯› (10åˆ† / 2,200å††)</div>
            <div class="b-menu-item" onclick="toggleMenu(this)" data-name="å†æ¥ï¼‘ã‚«æ‰€ã ã‘ã®éƒ¨åˆ†è„±æ¯›" data-price="4400" data-min="10">å†æ¥ï¼‘ãƒ¶æ‰€ã ã‘ã®éƒ¨åˆ†è„±æ¯› (10åˆ† / 4,400å††)</div>
            <div class="b-menu-item" onclick="toggleMenu(this)" data-name="çœ‰æ¯›ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°" data-price="2200" data-min="15">çœ‰æ¯›ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚° (15åˆ† / 2,200å††)</div>
        </div>

        <div class="b-total-box">
            åˆè¨ˆæ™‚é–“: <span id="total-time">0</span> åˆ†<br>
            åˆè¨ˆé‡‘é¡: <span id="total-price-disp">0</span> å††
        </div>

        <button type="button" id="submit-button" class="b-btn-submit" onclick="submitBooking()">ã“ã®å†…å®¹ã§äºˆç´„ã‚’ç¢ºå®šã™ã‚‹</button>

        <div id="error-msg-box" class="b-error-box" style="display:none; margin-top: 15px;">
            <div class="b-error-icon">âš ï¸</div>
            <div id="error-text" class="b-error-content"></div>
        </div>
        <div id="status-msg" style="text-align:center; margin-top:10px; font-weight:bold; color:#0073aa;"></div>
    </div>

    <div id="thanks-section" class="b-card" style="display:none; text-align:center; padding: 40px 20px;">
        <div style="font-size: 60px; color: #4caf50;">âœ”</div>
        <h2 style="margin: 10px 0 !important; color:#333 !important;">äºˆç´„ãŒç¢ºå®šã—ã¾ã—ãŸ</h2>
        <p style="color:#666; font-size:14px; margin-bottom: 20px;">ã”æ¥åº—ã‚’å¿ƒã‚ˆã‚ŠãŠå¾…ã¡ã—ã¦ãŠã‚Šã¾ã™ã€‚</p>

        <div style="background: #fff9e6; border: 1px solid #ffeeba; color: #856404; padding: 12px; border-radius: 8px; font-size: 13px; margin-bottom: 20px; display: flex; align-items: center; justify-content: center; gap: 8px;">
            <span style="font-size: 20px;">ğŸ“¸</span>
            <span><strong>ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ</strong>ã‚’ã—ã¦é ‚ãã¨<br>ã”äºˆç´„ã®ç¢ºèªã«ä¾¿åˆ©ã§ã™ã€‚</span>
        </div>
        
        <div id="booking-details" class="b-details-box" style="text-align: left; background: #f9f9f9; padding: 15px; border-radius: 10px; margin: 20px 0; line-height: 1.8;"></div>
        
        <button class="b-btn-submit" style="background:#666;" onclick="location.reload()">ãƒˆãƒƒãƒ—ã«æˆ»ã‚‹</button>
    </div>
</div>

<style>
.b-container { max-width: 600px; margin: 0 auto; font-family: sans-serif; color: #333; }
.b-card { background: #fff !important; border: 1px solid #e0e0e0 !important; border-radius: 16px; padding: 20px; margin-bottom:15px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
.b-nav { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
.b-month-label { font-weight: bold; font-size: 20px; }
.b-btn-nav { padding: 8px 15px; background: #f5f5f5; border: 1px solid #ddd; border-radius: 8px; cursor: pointer; }
.b-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 6px; }
.b-day { height: 45px; display: flex; align-items: center; justify-content: center; border-radius: 8px; cursor: pointer; border: 1px solid #f0f0f0; }
.b-day.selected { background: #0073aa !important; color: #fff !important; }
.b-day.today { border: 2px solid #0073aa; font-weight: bold; }

/* æ—¥ä»˜ã¨æ™‚é–“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
.b-date-header-info { margin-bottom: 10px; font-size: 14px; color: #666; text-align: center; }
.b-week-scroll { 
    overflow-x: auto; 
    overflow-y: auto; /* ç¸¦ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’æœ‰åŠ¹åŒ– */
    max-height: 550px; /* ã‚¹ãƒãƒ›ã§æ—¥ä»˜ãŒéš ã‚Œãªã„ç¨‹åº¦ã®é«˜ã• */
    border-radius: 10px; 
    border: 1px solid #eee; 
    position: relative; /* å­è¦ç´ ã®stickyã®åŸºæº– */
}
.b-week-table { display: flex; min-width: max-content; }
.b-day-column { flex: 0 0 95px; border-right: 1px solid #eee; padding: 0 5px 10px; }

/* æ—¥ä»˜ãƒ˜ãƒƒãƒ€ãƒ¼ã®å›ºå®š */
.b-day-header { 
    padding: 10px 0; 
    font-weight: bold; 
    text-align: center; 
    background: #0073aa; 
    color: #fff; 
    margin-bottom: 10px;
    position: sticky; 
    top: 0; 
    z-index: 10;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.b-slot { height: 40px; margin-bottom: 6px; display: flex; align-items: center; justify-content: center; border: 1px solid #0073aa !important; border-radius: 6px; cursor: pointer; font-size: 13px; background: #fff; }
.b-slot.booked { background: #fee !important; border-color: #fcc !important; color: #d33 !important; cursor: not-allowed; }
.b-slot.active { background: #0073aa !important; color: #fff !important; }

.b-label { display: block; margin: 20px 0 8px; font-weight: bold; }
.b-input { width: 100%; padding: 14px; border: 2px solid #ddd; border-radius: 10px; box-sizing: border-box; }
.b-menu-cat { margin: 20px 0 10px; padding: 5px 10px; background: #f0f7ff; border-left: 4px solid #0073aa; font-weight: bold; font-size: 13px; }
.b-menu-item { padding: 12px; border: 1px solid #ddd; border-radius: 8px; cursor: pointer; margin-bottom: 8px; font-size: 14px; background:#fff; }
.b-menu-item.selected { background: #e3f2fd; border-color: #0073aa; color: #0073aa; font-weight: bold; }
.b-total-box { padding: 20px; background: #f8f9fa; border-radius: 10px; text-align: right; margin: 20px 0; }
.b-btn-submit { width: 100%; padding: 18px; background: #0073aa; color: #fff; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; font-size: 18px; }
.b-btn-submit:disabled { background: #ccc; }
.b-error-box { padding: 15px; background: #fff5f5; border: 1px solid #feb2b2; border-radius: 10px; display: flex; align-items: center; color: #c53030; }
.b-error-icon { font-size: 24px; margin-right: 12px; }
.b-details-box { background: #f9f9f9; padding: 15px; border-radius: 10px; margin: 15px 0; text-align: left; }
</style>

<script>
(function() {
    var gasUrl = 'https://script.google.com/macros/s/AKfycbxonofHMmlr3j7xxcpx2s-ueJ9WsTyUhgQAUIpNFefUXMToWOvSnO_kEeOW_Ac73dCL/exec';
    var viewDate = new Date();
    var selDate = "", selTime = "";

    function init() { renderCalendar(); selectDay(formatDate(new Date())); }
    window.changeMonth = (d) => { viewDate.setMonth(viewDate.getMonth() + d); renderCalendar(); };
    function formatDate(dt) { return dt.getFullYear() + '-' + ('0'+(dt.getMonth()+1)).slice(-2) + '-' + ('0'+dt.getDate()).slice(-2); }

    function renderCalendar() {
        var grid = document.getElementById('calendar-grid');
        document.getElementById('current-month').innerText = viewDate.getFullYear() + "å¹´ " + (viewDate.getMonth() + 1) + "æœˆ";
        var html = '';
        ['æ—¥','æœˆ','ç«','æ°´','æœ¨','é‡‘','åœŸ'].forEach(w => html += `<div style="text-align:center;font-size:11px;color:#aaa;">${w}</div>`);
        var first = new Date(viewDate.getFullYear(), viewDate.getMonth(), 1).getDay();
        var last = new Date(viewDate.getFullYear(), viewDate.getMonth() + 1, 0).getDate();
        for(let i=0; i<first; i++) html += '<div></div>';
        for(let d=1; d<=last; d++) {
            let curr = formatDate(new Date(viewDate.getFullYear(), viewDate.getMonth(), d));
            let isToday = curr === formatDate(new Date());
            let cls = "b-day" + (curr === selDate ? " selected" : "") + (isToday ? " today" : "");
            html += `<div class="${cls}" onclick="selectDay('${curr}')">${d}</div>`;
        }
        grid.innerHTML = html;
    }

    window.selectDay = async function(dStr) {
        selDate = dStr; renderCalendar();
        var table = document.getElementById('week-table');
        table.innerHTML = '<div style="padding:40px; text-align:center; width:100%;">èª­ã¿è¾¼ã¿ä¸­...</div>';
        try {
            let res = await fetch(gasUrl + "?date=" + dStr);
            let allBooked = await res.json();
            let weekHtml = '';
            for(let i=0; i<7; i++) {
                let target = new Date(dStr.replace(/-/g, '/')); 
                target.setDate(target.getDate() + i);
                let dString = formatDate(target);
                let dayOfWeek = target.getDay();

                weekHtml += `<div class="b-day-column"><div class="b-day-header">${target.getMonth()+1}/${target.getDate()}</div>`;
                
                let dayBooked = allBooked.filter(b => b.date === dString);
                let isHoliday = dayBooked.some(b => b.title === "æ—¥æœ¬ã®ç¥æ—¥");
                let isAllDayOff = dayBooked.some(b => b.start === "0:00" && b.end === "23:59");
                
                if(isAllDayOff) {
                    weekHtml += '<div style="text-align:center;padding:20px;color:#ccc;font-size:12px;">åº—ä¼‘æ—¥</div></div>';
                    continue;
                }

                let closingHour = (dayOfWeek === 0 || dayOfWeek === 6 || isHoliday) ? 21 : 22;

                for(let h=10; h < closingHour; h++) {
                    ['00','15','30','45'].forEach(m => {
                        let t = h + ":" + m;
                        let isB = dayBooked.some(b => {
                            let ts = t.split(':').reduce((acc,v)=>acc*60+ +v,0);
                            let bs = b.start.split(':').reduce((acc,v)=>acc*60+ +v,0);
                            let be = b.end.split(':').reduce((acc,v)=>acc*60+ +v,0);
                            return ts >= bs && ts < be;
                        });
                        weekHtml += `<div class="b-slot ${isB?'booked':''}" ${isB?'':`onclick="clickTime('${dString}','${t}')"`} data-dt="${dString}_${t}">${isB?'Ã—':'â—‹ '+t}</div>`;
                    });
                }
                weekHtml += '</div>';
            }
            table.innerHTML = weekHtml;
            if(selTime) {
                const activeSlot = document.querySelector(`[data-dt="${selDate}_${selTime}"]`);
                if(activeSlot) activeSlot.classList.add('active');
            }
        } catch(e) { table.innerHTML = 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ'; }
    };

    window.clickTime = (d, t) => {
        selDate = d; selTime = t;
        document.querySelectorAll('.b-slot').forEach(s => s.classList.remove('active'));
        const target = document.querySelector(`[data-dt="${d}_${t}"]`);
        if(target) target.classList.add('active');
        const formSec = document.getElementById('form-section');
        formSec.style.display = 'block';
        updateSummary();
        setTimeout(() => { formSec.scrollIntoView({ behavior: 'smooth', block: 'start' }); }, 100);
    };

    window.toggleMenu = (el) => { el.classList.toggle('selected'); updateSummary(); };

    function updateSummary() {
        var time = 0, price = 0;
        document.querySelectorAll('.b-menu-item.selected').forEach(el => {
            time += parseInt(el.getAttribute('data-min'));
            price += parseInt(el.getAttribute('data-price'));
        });
        document.getElementById('total-time').innerText = time;
        document.getElementById('total-price-disp').innerText = price.toLocaleString();
        document.getElementById('res-summary').innerHTML = `<div style="font-size:14px; color:#555;">é¸æŠä¸­ã®æ—¥æ™‚</div><div style="font-size:18px; font-weight:bold;">${selDate.replace(/-/g,'/')} ${selTime} ã€œ</div>`;
    }

    window.submitBooking = function() {
        var name = document.getElementById('u-name').value;
        var tel = document.getElementById('u-tel').value;
        var menus = [];
        document.querySelectorAll('.b-menu-item.selected').forEach(el => menus.push(el.getAttribute('data-name')));
        
        if(!name) return alert("ãŠåå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
        if(!tel) return alert("é›»è©±ç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
        if(menus.length === 0) return alert("ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚");

        var totalTime = document.getElementById('total-time').innerText;
        var totalPrice = document.getElementById('total-price-disp').innerText;
        var btn = document.getElementById('submit-button');
        var errBox = document.getElementById('error-msg-box');
        
        // submitBookingé–¢æ•°å†…
        var postData = {
        name: name,
        tel: tel,
        notes: document.getElementById('u-notes').value, // ã“ã“ã‚’è¿½åŠ 
         menu: menus.join('ã€'),
        date: selDate,
        time: selTime,
        price: totalPrice,
        duration: totalTime
        };

        btn.disabled = true;
        errBox.style.display = 'none';
        document.getElementById('status-msg').innerText = "äºˆç´„ã‚’ç¢ºå®šã—ã¦ã„ã¾ã™...";

        fetch(gasUrl, { method: "POST", body: JSON.stringify(postData) })
        .then(r => r.text())
        .then(result => {
            if (result.includes("Success")) {
    document.getElementById('booking-details').innerHTML = `
        <div style="border-bottom: 1px dashed #ccc; padding-bottom: 10px; margin-bottom: 10px;">
            <strong>â–  ã”äºˆç´„æ—¥æ™‚</strong><br>
            ${selDate.replace(/-/g,'/')} ${selTime} ã€œ
        </div>
        <div style="border-bottom: 1px dashed #ccc; padding-bottom: 10px; margin-bottom: 10px;">
            <strong>â–  ãƒ¡ãƒ‹ãƒ¥ãƒ¼</strong><br>
            ${postData.menu}
        </div>
        <div style="border-bottom: 1px dashed #ccc; padding-bottom: 10px; margin-bottom: 10px;">
            <strong>â–  å‚™è€ƒï¼ˆã”è¦æœ›ãªã©ï¼‰</strong><br>
            ${postData.notes || "ãªã—"}
        </div>
        <div style="display: flex; justify-content: space-between; align-items: center; background: #fff; padding: 10px; border-radius: 8px;">
            <div>
                <strong>â–  æ‰€è¦æ™‚é–“</strong><br>
                <span>${totalTime} åˆ†</span>
            </div>
            <div style="text-align: right;">
                <strong>â–  åˆè¨ˆé‡‘é¡ï¼ˆç›®å®‰ï¼‰</strong><br>
                <span style="font-size:18px; color:#d33; font-weight:bold;">${totalPrice} å††</span>
            </div>
        </div>
    `;
                document.getElementById('calendar-area').style.display = 'none';
                document.getElementById('time-section').style.display = 'none';
                document.getElementById('form-section').style.display = 'none';
                document.getElementById('thanks-section').style.display = 'block';
                window.scrollTo(0,0);
            } else {
                let msg = result.includes("Conflict") ? "ç”³ã—è¨³ã‚ã‚Šã¾ã›ã‚“ã€‚ã‚¿ãƒƒãƒã®å·®ã§ä»–ã®äºˆç´„ãŒå…¥ã‚Šã¾ã—ãŸã€‚" : "ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚";
                document.getElementById('error-text').innerHTML = msg;
                errBox.style.display = 'flex';
                btn.disabled = false;
                document.getElementById('status-msg').innerText = "";
            }
        })
        .catch(e => {
            document.getElementById('error-text').innerHTML = "é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚";
            errBox.style.display = 'flex';
            btn.disabled = false;
        });
    };
    init();
})();
</script>